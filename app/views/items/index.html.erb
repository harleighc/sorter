<div class = container-fluid>
<button type="button" class="btn btn-default navbar-btn">
<% if current_user %>
  <%= link_to "Sign Out", destroy_user_session_path, method: :delete %></button>
</div>

<% if user_signed_in? %>

<div class = "col-md-12" >
  <div class="page-header">
    <h1> <%= params[:cat] %></h1><%= link_to "Make " + params[:cat] +" a non business income or expense" ,edit_gst_path(:cat => params[:cat]) %>
</div>

<div class = container-fluid>

<div class = "row">
  <div class = "col-md-3"  >

   <% @live_categories_system[0..5].each do |cat| %>
    <button type="button" class="btn btn-default btn-block" >
      <% text = cat + " " + number_to_currency(Item.where("category = ?", cat).sum(:value),:unit => "$") %>
          <%= link_to text , items_path(:cat => cat, :layout => "grouped" ) %>
            <% end %></button>

    <% @live_categories_system[6..11].each do |cat| %>
      <button type="button" class="btn btn-default btn-block" >
       <% text = cat + " " + number_to_currency(Item.where("category = ?", cat).sum(:value),:unit => "$") %>
          <%= link_to text, items_path(:cat => cat, :layout => "grouped" ) %>
            <% end %></button>

   <% @live_categories_user.each do |cat| %>
        <button type="button" class="btn btn-default btn-block" >
          <%= link_to cat + " " + number_to_currency(Item.where("category = ?", cat).sum(:value),:unit => "$"), items_path(:cat => cat, :layout => "grouped" ) %>
            <% end %></button>

    <% n = @live_categories_user.length %>
          <button type="button" class="btn btn-default btn-block" >
      <%= link_to "new" , new_categorytable_path %></button>

</div>




 <div class = "col-md-9" >
   <div class="span3">
      <table class="table table-hover">
        <colgroup>
                  <col class="col-md-1">
                  <col class="col-md-1">
                  <col class="col-md-7">
                  <col class="col-md-2.0">
                  <col class="col-md-1">

<% if @layout == "expandgroup" %>
<tbody>
  <% counter = 0 %>
    <% @expandgrouptop.each do |i| %>
<tr>
  <td><%= link_to "show" , item_path(:cat => params[:cat], :id => i[:id]) %></td>
    <td><% if counter == 0 %>
    <%= link_to items_path(:cat => params[:cat], :layout => "grouped" ), class: "btn btn-default" do %>
    <i class="glyphicon glyphicon-chevron-down"></i>
        <% end %>
      <% counter += 1 %>
      <% else %>
   <%= nil  %>
  <% end %></td>

    <td><%= link_to i.item  , edit_item_path(:id => i, :form => "category" ) %></td>
    <td><%= number_to_currency(i.value, :unit => "$") %></td>
    <td><%= link_to edit_item_path(:id => i, :form => "status" ), class: "btn btn-default" do %><i class="glyphicon glyphicon-ok"></i></td>

    <% end %>
  <% end %>
<tr>


    <% @expandgroupbottom.each do |it,tot,maxstatus| %>
<tr>
  <td><%= maxstatus %></td>
    <td><% n = Item.where(:item => it).where(:category => params[:cat]).count(:item) %>
      <% case n %>
        <% when 1 %>
          <%= nil %>
        <% else %>
          <%= link_to items_path(:cat => params[:cat], :layout => "expandgroup", :item => it ), class: "btn btn-default" do %><i class="glyphicon glyphicon-th"></i></td>
        <% end %>
       <% end %>
     <td><%= link_to it ,edit_category_path(:cat => params[:cat], :item => it) %></td>
     <td><%= number_to_currency(tot,:unit => "$") %></td>
     <td><%= link_to edit_confirms_path(:cat => params[:cat], :item => it), class: "btn btn-default" do %>
    <i class="glyphicon glyphicon-ok"></i></td>
      <%end%>
    <% end %>
</tr>

</tbody>


<% elsif @layout == "grouped" %>
 <tbody>
   <% @grouped.each do |it,tot,maxstatus| %>
      <tr>
        <td><%= maxstatus %></td>
      <td><% n = Item.where(:item => it).where(:category => params[:cat]).count(:item) %>
        <% case n %>
        <% when 1 %>
        <%= nil %>
        <% else %>
       <%= link_to items_path(:cat => params[:cat], :layout => "expandgroup", :item => it ), class: "btn btn-default" do %><i class="glyphicon glyphicon-th"></i></td>

        <% end %>
        <% end %>
        <td><%= link_to it ,edit_category_path(:cat => params[:cat], :item => it) %></td>
        <td><%= number_to_currency(tot,:unit => "$") %></td>

        <td><%= link_to edit_confirms_path(:cat => params[:cat], :item => it), class: "btn btn-default" do %>
    <i class="glyphicon glyphicon-ok"></i></td>

        <%end%>
      <% end %>
    </tr>
  </tbody>



<% elsif @layout == "itemised" %>
  <tbody>
    <% @itemised.each do |it| %>
      <tr>
        <td><%= link_to it.item  , edit_item_path(:id => it, :form => "category" ) %></td>
        <td><%= number_to_currency(it.value, :unit => "$") %></td>
        <td><%= link_to item_path(:id => it, :form => "status" ), class: "btn btn-default" do %>
    <i class="glyphicon glyphicon-zoom-in"></i>
          <%= link_to edit_item_path(:id => it, :form => "status" ), class: "btn btn-default" do %>
    <i class="glyphicon glyphicon-ok"></i>   </td>
    <% end %>
    <% end %>
    <% end %>
    <% end %>
     </tr>
  </tbody>


</colgroup>
 </table>
</div>
 </div>
</div>
</div>

<% end %>
<% end %>

 <%= number_to_currency(@gsttotal ,:unit => "$") %>
<%=  @total_of_live_categories == @total_from_db  %>

<h2>GST Totals</h2>
<% @cattotals.each do |cat,tot| %>
<td> <%= cat %>  <%= number_to_currency(tot,:unit => "$")   %> </td>
<% end %>






